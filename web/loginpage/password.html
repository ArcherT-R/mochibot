<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Set Password</title>
<style>
  body { font-family: Arial, sans-serif; background:#f7f7f7; display:flex; justify-content:center; align-items:center; height:100vh; }
  .container { background:white; padding:30px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); width:300px; }
  input { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; }
  button { width:100%; padding:10px; background:#42b4ff; color:white; border:none; border-radius:5px; cursor:pointer; }
  button:hover { background:#1a85e6; }
  .error { color:red; font-size:0.9em; }
  .success { color:green; font-size:0.9em; }
</style>
</head>
<body>
<div class="container">
  <h2>Set Password</h2>
  <input type="hidden" id="username">
  <input type="password" id="password" placeholder="Enter password">
  <input type="password" id="confirmPassword" placeholder="Confirm password">
  <button id="setBtn">Set Password</button>
  <div id="message"></div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const username = params.get('username');
if(!username) window.location = '/loginpage/signup'; // fallback
document.getElementById('username').value = username;

document.getElementById('setBtn').addEventListener('click', async () => {
  const password = document.getElementById('password').value.trim();
  const confirm = document.getElementById('confirmPassword').value.trim();
  const message = document.getElementById('message');
  message.textContent = '';

  if(!password || !confirm) { message.textContent='Fill all fields'; message.className='error'; return; }
  if(password !== confirm) { message.textContent='Passwords do not match'; message.className='error'; return; }

  try {
    const res = await fetch('/loginpage/set-password', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if(data.success){
      message.textContent = 'Password set! You can now log in.';
      message.className='success';
      setTimeout(()=>{ window.location = '/loginpage/login'; }, 1500);
    } else {
      message.textContent = data.error || 'Failed to set password';
      message.className='error';
    }
  } catch(err){
    console.error(err);
    message.textContent = 'Server error';
    message.className='error';
  }
});
</script>
</body>
</html>
